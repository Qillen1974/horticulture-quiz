<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± Horticulture Quiz - Learn Plants!</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #276749;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .category-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: #f0fff4;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 12px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            background: #c6f6d5;
            color: #276749;
        }

        .category-btn.active {
            background: #48bb78;
            color: white;
            transform: scale(1.05);
        }

        .quiz-area {
            padding: 25px;
        }

        .question-card {
            background: #f0fff4;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-emoji {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .question-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            margin-bottom: 15px;
            object-fit: contain;
        }

        .question-text {
            font-size: 1.4rem;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .question-hint {
            font-size: 1rem;
            color: #718096;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        @media (max-width: 600px) {
            .options {
                grid-template-columns: 1fr;
            }
            .match-container {
                flex-direction: column;
            }
            .match-column {
                width: 100% !important;
            }
        }

        .option-btn {
            padding: 15px;
            font-size: 1.1rem;
            border: 3px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
            font-weight: bold;
            color: #2d3748;
        }

        .option-btn:hover {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .option-btn.correct {
            border-color: #48bb78;
            background: #c6f6d5;
            color: #22543d;
        }

        .option-btn.incorrect {
            border-color: #f56565;
            background: #fed7d7;
            color: #742a2a;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            text-align: center;
            font-size: 1.2rem;
            margin: 15px 0;
            padding: 12px;
            border-radius: 10px;
            display: none;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            display: block;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            display: block;
        }

        .next-btn {
            display: block;
            margin: 15px auto;
            padding: 12px 30px;
            font-size: 1.1rem;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .next-btn:hover {
            background: #38a169;
        }

        .score {
            text-align: center;
            font-size: 1.1rem;
            color: #718096;
            padding: 12px;
            background: #f7fafc;
            border-radius: 10px;
            margin-top: 15px;
        }

        .score-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #48bb78;
        }

        .explanation {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 12px;
            margin: 12px 0;
            border-radius: 0 8px 8px 0;
            display: none;
            font-size: 0.95rem;
        }

        .explanation.show {
            display: block;
        }

        /* Match styles */
        .match-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .match-column {
            width: 45%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .match-column h3 {
            text-align: center;
            color: #276749;
            margin-bottom: 5px;
        }

        .match-item {
            padding: 12px;
            border: 3px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            color: #2d3748;
            user-select: none;
        }

        .match-item:hover {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .match-item.selected {
            border-color: #4299e1;
            background: #ebf8ff;
            transform: scale(1.03);
        }

        .match-item.matched {
            border-color: #48bb78;
            background: #c6f6d5;
            cursor: default;
            opacity: 0.8;
        }

        .match-item.wrong {
            border-color: #f56565;
            background: #fed7d7;
            animation: shake 0.4s;
        }

        .match-item img {
            max-width: 100%;
            max-height: 120px;
            border-radius: 6px;
            object-fit: contain;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .match-score {
            text-align: center;
            font-size: 1.3rem;
            color: #276749;
            font-weight: bold;
            margin: 15px 0;
        }

        .match-round-info {
            text-align: center;
            font-size: 1.1rem;
            color: #718096;
            margin-bottom: 15px;
        }

        /* Assessment styles */
        .assessment-intro {
            text-align: center;
            padding: 30px 20px;
        }

        .assessment-intro h2 {
            font-size: 1.6rem;
            color: #276749;
            margin-bottom: 15px;
        }

        .assessment-intro p {
            font-size: 1.1rem;
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .assessment-start-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .assessment-start-btn:hover {
            background: #38a169;
            transform: scale(1.05);
        }

        .assessment-progress {
            text-align: center;
            margin-bottom: 15px;
        }

        .assessment-progress-text {
            font-size: 1.1rem;
            color: #4a5568;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            border-radius: 6px;
            transition: width 0.4s ease;
        }

        .assessment-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 3px solid #e2e8f0;
            border-radius: 10px;
            margin: 15px 0;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .assessment-input:focus {
            outline: none;
            border-color: #48bb78;
        }

        .assessment-input.correct-border {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .assessment-input.incorrect-border {
            border-color: #f56565;
            background: #fff5f5;
        }

        .assessment-submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .assessment-submit-btn:hover {
            background: #3182ce;
        }

        .assessment-submit-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }

        .model-answer {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            font-size: 1.05rem;
            line-height: 1.5;
        }

        .model-answer strong {
            color: #2b6cb0;
        }

        .self-assess-buttons {
            display: flex;
            gap: 12px;
            margin: 15px 0;
        }

        .self-assess-btn {
            flex: 1;
            padding: 15px;
            font-size: 1.1rem;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .self-assess-btn.got-it {
            background: #c6f6d5;
            color: #22543d;
            border-color: #48bb78;
        }

        .self-assess-btn.got-it:hover {
            background: #9ae6b4;
        }

        .self-assess-btn.not-quite {
            background: #fed7d7;
            color: #742a2a;
            border-color: #f56565;
        }

        .self-assess-btn.not-quite:hover {
            background: #feb2b2;
        }

        .assessment-feedback {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .assessment-feedback.correct {
            background: #c6f6d5;
            color: #22543d;
        }

        .assessment-feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
        }

        .assessment-next-btn {
            display: block;
            margin: 15px auto;
            padding: 12px 30px;
            font-size: 1.1rem;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .assessment-next-btn:hover {
            background: #38a169;
        }

        .results-summary {
            text-align: center;
            padding: 20px;
        }

        .results-summary h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .results-score {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 15px 0;
        }

        .results-score.pass {
            color: #48bb78;
        }

        .results-score.fail {
            color: #e53e3e;
        }

        .results-message {
            font-size: 1.2rem;
            color: #4a5568;
            margin: 15px 0;
            line-height: 1.5;
        }

        .results-percentage {
            font-size: 1.1rem;
            color: #718096;
            margin-bottom: 20px;
        }

        .review-list {
            text-align: left;
            margin: 20px 0;
        }

        .review-list h3 {
            color: #276749;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .review-item {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }

        .review-item .review-q {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .review-item .review-your {
            color: #742a2a;
        }

        .review-item .review-correct {
            color: #22543d;
            font-weight: bold;
        }

        .assessment-category-tag {
            display: inline-block;
            background: #e2e8f0;
            color: #4a5568;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Horticulture Quiz</h1>
            <p>Learn about plants and gardening!</p>
        </div>

        <div class="category-selector">
            <button class="category-btn active" onclick="setCategory('tools', this)">üîß Tools</button>
            <button class="category-btn" onclick="setCategory('toolparts', this)">üî© Tool Parts</button>
            <button class="category-btn" onclick="setCategory('toolquality', this)">‚úÖ Tool Quality</button>
            <button class="category-btn" onclick="setCategory('match', this)">üîó Match Tools</button>
            <button class="category-btn" onclick="setCategory('propagation', this)">üåø Propagation</button>
            <button class="category-btn" onclick="setCategory('media', this)">ü™¥ Soil Mix</button>
            <button class="category-btn" onclick="setCategory('matchmedia', this)">üîó Match Media</button>
            <button class="category-btn" onclick="setCategory('plantcare', this)">üå± Plant Care</button>
            <button class="category-btn" onclick="setCategory('safety', this)">‚ö†Ô∏è Safety</button>
            <button class="category-btn" onclick="setCategory('assessment', this)">üìù Assessment</button>
        </div>

        <!-- Standard quiz area -->
        <div class="quiz-area" id="quizArea">
            <div class="question-card">
                <img class="question-image" id="questionImage" style="display:none" alt="Question image">
                <div class="question-emoji" id="questionEmoji">‚úÇÔ∏è</div>
                <div class="question-text" id="questionText">What tool is this?</div>
                <div class="question-hint" id="questionHint">Select the correct answer!</div>
            </div>

            <div class="options" id="options"></div>

            <div class="explanation" id="explanation"></div>

            <div class="feedback" id="feedback"></div>

            <button class="next-btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question ‚û°Ô∏è</button>

            <div class="score">
                <div>Score</div>
                <div class="score-number" id="scoreNumber">0</div>
                <div id="scoreText">Correct: 0 | Total: 0</div>
            </div>
        </div>

        <!-- Match area (shared by Match Tools and Match Media) -->
        <div class="quiz-area" id="matchArea" style="display: none;">
            <div class="match-round-info" id="matchRoundInfo">Round 1: Match each tool to its name</div>
            <div class="match-container" id="matchContainer"></div>
            <div class="match-score" id="matchScore"></div>
            <button class="next-btn" id="matchNextBtn" style="display: none;">Next Round ‚û°Ô∏è</button>
            <button class="next-btn" id="matchRestartBtn" style="display: none;">Play Again üîÑ</button>
        </div>

        <!-- Assessment area -->
        <div class="quiz-area" id="assessmentArea" style="display: none;"></div>
    </div>

    <script>
        let currentCategory = 'tools';
        let score = { correct: 0, total: 0 };
        let currentQuestion = {};
        let answered = false;
        let askedQuestions = {}; // track asked question indices per category

        // Match state
        let matchSelectedLeft = null;
        let matchSelectedRight = null;
        let matchPairs = [];
        let matchMatched = 0;
        let matchRound = 1;
        let matchCorrect = 0;
        let matchTotal = 0;
        let activeMatchType = 'tools'; // 'tools' or 'media'

        const toolData = [
            { image: "images/tools images/IMG_9968.jpeg", name: "Hand Trowel", func: "Dig, scoop, and smooth soil media" },
            { image: "images/tools images/IMG_9969.jpeg", name: "Secateurs", func: "Cut stems, leaves, and roots" },
            { image: "images/tools images/IMG_9970.jpeg", name: "Hand Fork", func: "Loosen soil and remove weeds" },
            { image: "images/tools images/IMG_9971.jpeg", name: "Pungkis", func: "Collect debris during weeding" },
            { image: "images/tools images/IMG_9972.jpeg", name: "Rake", func: "Sweep dried leaves and dirt" },
            { image: "images/tools images/IMG_9973.jpeg", name: "Watering Can", func: "Water plants" },
            { image: "images/tools images/IMG_9974.jpeg", name: "Wheelbarrow", func: "Carry soil, plants, and debris" }
        ];

        const mediaData = [
            { image: "images/media images/IMG_9959.jpeg", name: "Sand", func: "Improves drainage" },
            { image: "images/media images/IMG_9960.jpeg", name: "Top Soil", func: "Provides nutrients" },
            { image: "images/media images/IMG_9961.jpeg", name: "Cocopeat", func: "Holds water" },
            { image: "images/media images/IMG_9962.jpeg", name: "Perlite", func: "Aeration and drainage" },
            { image: "images/media images/IMG_9963.jpeg", name: "Vermiculite", func: "Water and nutrient retention" }
        ];

        const questions = {
            tools: [
                { image: "images/tools images/IMG_9968.jpeg", question: "What tool is this?", options: ["Hand Trowel", "Secateurs", "Hand Fork", "Pungkis"], correct: 0, explanation: "Hand Trowel - used to dig, scoop, and smooth soil media!" },
                { image: "images/tools images/IMG_9968.jpeg", question: "What is this tool's function?", options: ["Dig, scoop, smooth soil", "Cut stems/leaves", "Loosen soil, remove weeds", "Collect debris"], correct: 0, explanation: "The Hand Trowel is for digging, scooping, and smoothing soil!" },
                { image: "images/tools images/IMG_9969.jpeg", question: "What tool is this?", options: ["Secateurs", "Hand Trowel", "Hand Fork", "Rake"], correct: 0, explanation: "Secateurs - pruning shears for cutting!" },
                { image: "images/tools images/IMG_9969.jpeg", question: "What is this tool's function?", options: ["Cut stems, leaves, roots", "Dig soil", "Water plants", "Sweep leaves"], correct: 0, explanation: "Secateurs cut stems, leaves, and roots!" },
                { image: "images/tools images/IMG_9970.jpeg", question: "What tool is this?", options: ["Hand Fork", "Hand Trowel", "Secateurs", "Pungkis"], correct: 0, explanation: "Hand Fork!" },
                { image: "images/tools images/IMG_9970.jpeg", question: "What is this tool's function?", options: ["Loosen soil, remove weeds", "Cut stems", "Carry things", "Water plants"], correct: 0, explanation: "The Hand Fork loosens soil and removes weeds!" },
                { image: "images/tools images/IMG_9971.jpeg", question: "What tool is this?", options: ["Pungkis", "Wheelbarrow", "Rake", "Watering Can"], correct: 0, explanation: "Pungkis - a basket/scoop for collecting debris!" },
                { image: "images/tools images/IMG_9971.jpeg", question: "What is this tool's function?", options: ["Collect debris during weeding", "Carry soil", "Water plants", "Cut stems"], correct: 0, explanation: "Pungkis collects debris during weeding!" },
                { image: "images/tools images/IMG_9972.jpeg", question: "What tool is this?", options: ["Rake", "Hand Fork", "Wheelbarrow", "Watering Can"], correct: 0, explanation: "Rake!" },
                { image: "images/tools images/IMG_9972.jpeg", question: "What is this tool's function?", options: ["Sweep dried leaves and dirt", "Cut stems", "Water plants", "Dig soil"], correct: 0, explanation: "The Rake sweeps dried leaves and dirt!" },
                { image: "images/tools images/IMG_9973.jpeg", question: "What tool is this?", options: ["Watering Can", "Wheelbarrow", "Pungkis", "Secateurs"], correct: 0, explanation: "Watering Can!" },
                { image: "images/tools images/IMG_9973.jpeg", question: "What is this tool's function?", options: ["Water plants", "Carry soil", "Cut stems", "Loosen soil"], correct: 0, explanation: "The Watering Can is used to water plants!" },
                { image: "images/tools images/IMG_9974.jpeg", question: "What tool is this?", options: ["Wheelbarrow", "Rake", "Pungkis", "Hand Fork"], correct: 0, explanation: "Wheelbarrow!" },
                { image: "images/tools images/IMG_9974.jpeg", question: "What is this tool's function?", options: ["Carry soil, plants, debris", "Water plants", "Cut stems", "Sweep leaves"], correct: 0, explanation: "The Wheelbarrow carries soil, plants, and debris!" }
            ],
            toolparts: [
                { image: "images/tools images/IMG_9958.jpeg", question: "What is Part A on the secateurs?", options: ["Blades", "Safety Lock Catch", "Handle", "Spring"], correct: 0, explanation: "Part A = Blades - the sharp cutting edges of the secateurs!" },
                { image: "images/tools images/IMG_9958.jpeg", question: "What is Part B on the secateurs?", options: ["Safety Lock Catch", "Blades", "Handle", "Pivot Bolt"], correct: 0, explanation: "Part B = Safety Lock Catch - keeps the secateurs closed when not in use!" },
                { image: "images/tools images/IMG_9958.jpeg", question: "What is Part C on the secateurs?", options: ["Handle", "Blades", "Safety Lock Catch", "Spring"], correct: 0, explanation: "Part C = Handle - where you grip the secateurs!" },
                { image: "images/tools images/IMG_9958.jpeg", question: "Which part are the Blades?", options: ["Part A", "Part B", "Part C", "Part D"], correct: 0, explanation: "The Blades are labeled as Part A!" },
                { image: "images/tools images/IMG_9958.jpeg", question: "Which part is the Safety Lock Catch?", options: ["Part B", "Part A", "Part C", "Part D"], correct: 0, explanation: "The Safety Lock Catch is labeled as Part B!" },
                { image: "images/tools images/IMG_9958.jpeg", question: "Which part is the Handle?", options: ["Part C", "Part A", "Part B", "Part D"], correct: 0, explanation: "The Handle is labeled as Part C!" }
            ],
            toolquality: [
                { image: "images/tools images/IMG_9964.jpeg", question: "Is this tool in good or poor condition?", options: ["Poor quality", "Good quality"], correct: 0, explanation: "Poor condition - the secateur blade is rusty and worn, making it unsafe and ineffective!" },
                { image: "images/tools images/IMG_9965.jpeg", question: "Is this tool in good or poor condition?", options: ["Good quality", "Poor quality"], correct: 0, explanation: "Good condition - this hand trowel is new and in proper working order!" },
                { image: "images/tools images/IMG_9966.jpeg", question: "Is this tool in good or poor condition?", options: ["Good quality", "Poor quality"], correct: 0, explanation: "Good condition - these secateurs are in use and well-maintained!" },
                { image: "images/tools images/IMG_9967.jpeg", question: "Is this tool in good or poor condition?", options: ["Poor quality", "Good quality"], correct: 0, explanation: "Poor condition - the trowel handle is broken and detached, making it unusable!" }
            ],
            propagation: [
                // Q1 - Four asexual propagation methods
                { image: "images/quiz images/IMG_9975.jpeg", question: "How many asexual propagation methods are there?", options: ["4", "2", "6", "3"], correct: 0, explanation: "There are 4 asexual propagation methods: Cutting, Grafting, Division, and Layering!" },
                { image: "images/quiz images/IMG_9975.jpeg", question: "Which of these is NOT an asexual propagation method?", options: ["Seeds", "Cutting", "Grafting", "Layering"], correct: 0, explanation: "Seeds is sexual propagation. The 4 asexual methods are: Cutting, Grafting, Division, and Layering!" },
                { image: "images/quiz images/IMG_9975.jpeg", question: "What is 'Cutting' in propagation?", options: ["Making new plants from a cut piece of the parent plant", "Joining different parts of plants", "Separating the rooted stem", "Making plants from rooted crowns"], correct: 0, explanation: "Cutting means making new plants from a cut piece of the parent plant!" },
                { image: "images/quiz images/IMG_9975.jpeg", question: "What is 'Grafting' in propagation?", options: ["Joining different parts of plants", "Cutting a stem from the parent", "Dividing rooted crowns", "Separating rooted stems"], correct: 0, explanation: "Grafting creates new plants by joining different parts of plants together!" },
                { image: "images/quiz images/IMG_9975.jpeg", question: "What is 'Division' in propagation?", options: ["Making new plants from rooted crowns", "Cutting a stem", "Joining plant parts", "Layering a branch"], correct: 0, explanation: "Division makes new plants from one of the many rooted crowns!" },
                { image: "images/quiz images/IMG_9975.jpeg", question: "What is 'Layering' in propagation?", options: ["Separating the rooted stem from the parent plant", "Cutting a piece off", "Joining two plants", "Planting seeds"], correct: 0, explanation: "Layering separates the rooted stem from the parent plant!" },
                // Q2 - Parent plant
                { image: "images/quiz images/IMG_9976.jpeg", question: "What is a parent plant used for?", options: ["Making new plants through cuttings, division, layering, or grafting", "Decoration only", "Producing seeds only", "Providing shade"], correct: 0, explanation: "A parent plant is used for making new plants through cuttings, division, layering, or grafting!" },
                { image: "images/quiz images/IMG_9976.jpeg", question: "Why are new plants from a parent plant high quality?", options: ["They share the same genes as the parent", "They grow faster", "They need less water", "They are bigger"], correct: 0, explanation: "New plants are high quality because they share the same genes as the parent!" },
                // Q3 - Two graft types
                { image: "images/quiz images/IMG_9977.jpeg", question: "What are the two types of graft?", options: ["Scion graft and Bud graft", "Root graft and Leaf graft", "Stem graft and Bark graft", "Top graft and Side graft"], correct: 0, explanation: "The two types are Scion graft (putting a small plant piece onto stock) and Bud graft (moving a leaf bud from one tree to another)!" },
                { image: "images/quiz images/IMG_9977.jpeg", question: "What is a Scion graft?", options: ["Putting a small plant piece (scion) onto another plant (stock)", "Moving a leaf bud from one tree to another", "Cutting a root in half", "Planting two seeds together"], correct: 0, explanation: "A Scion graft involves putting a small plant piece (scion) onto another plant (stock)!" },
                { image: "images/quiz images/IMG_9977.jpeg", question: "What is a Bud graft?", options: ["Moving a leaf bud from one tree to another", "Putting a scion onto stock", "Dividing a root ball", "Layering a branch"], correct: 0, explanation: "A Bud graft involves moving a leaf bud from one tree to another!" },
                // Q4 - Pest/disease treatment
                { image: "images/quiz images/IMG_9978.jpeg", question: "How do you treat buds for pests and diseases?", options: ["Dip in fungicide solution and keep in a cool, moist place", "Spray with water only", "Leave them in sunlight", "Cover with plastic wrap"], correct: 0, explanation: "Dip the buds in a fungicide solution and keep them in a cool, moist place!" },
                { image: "images/quiz images/IMG_9978.jpeg", question: "What solution do you dip buds in to treat pests?", options: ["Fungicide solution", "Salt water", "Sugar water", "Plain water"], correct: 0, explanation: "Buds should be dipped in a fungicide solution to treat pests and diseases!" },
                { image: "images/quiz images/IMG_9978.jpeg", question: "After dipping buds in fungicide, where should you keep them?", options: ["In a cool, moist place", "In direct sunlight", "In a dry, hot area", "In the freezer"], correct: 0, explanation: "After treating with fungicide, keep the buds in a cool, moist place!" }
            ],
            media: [
                { image: "images/media images/IMG_9959.jpeg", question: "What soil media is this?", options: ["Sand", "Top Soil", "Cocopeat", "Perlite"], correct: 0, explanation: "Sand - the grainy, light-colored media that improves drainage!" },
                { image: "images/media images/IMG_9959.jpeg", question: "What is the function of Sand?", options: ["Improves drainage", "Holds water", "Adds nutrients", "Retains moisture"], correct: 0, explanation: "Sand improves drainage in the soil mix!" },
                { image: "images/media images/IMG_9960.jpeg", question: "What soil media is this?", options: ["Top Soil", "Sand", "Cocopeat", "Vermiculite"], correct: 0, explanation: "Top Soil - the dark, nutrient-rich soil!" },
                { image: "images/media images/IMG_9960.jpeg", question: "What is the function of Top Soil?", options: ["Provides nutrients", "Improves drainage", "Holds water", "Lightweight"], correct: 0, explanation: "Top Soil provides nutrients for plants!" },
                { image: "images/media images/IMG_9961.jpeg", question: "What soil media is this?", options: ["Cocopeat", "Top Soil", "Vermiculite", "Sand"], correct: 0, explanation: "Cocopeat - the brown fibrous material made from coconut husks!" },
                { image: "images/media images/IMG_9961.jpeg", question: "What is the function of Cocopeat?", options: ["Holds water", "Improves drainage", "Adds nitrogen", "Makes soil heavy"], correct: 0, explanation: "Cocopeat holds water and keeps the soil moist!" },
                { image: "images/media images/IMG_9962.jpeg", question: "What soil media is this?", options: ["Perlite", "Vermiculite", "Sand", "Cocopeat"], correct: 0, explanation: "Perlite - the white, lightweight granules!" },
                { image: "images/media images/IMG_9962.jpeg", question: "What is the function of Perlite?", options: ["Aeration and drainage", "Holds water", "Adds nutrients", "Keeps soil cool"], correct: 0, explanation: "Perlite improves aeration and drainage!" },
                { image: "images/media images/IMG_9963.jpeg", question: "What soil media is this?", options: ["Vermiculite", "Perlite", "Sand", "Top Soil"], correct: 0, explanation: "Vermiculite - the golden, flaky material!" },
                { image: "images/media images/IMG_9963.jpeg", question: "What is the function of Vermiculite?", options: ["Water and nutrient retention", "Improves drainage", "Makes soil light", "Kills bacteria"], correct: 0, explanation: "Vermiculite retains water and nutrients!" },
                // Q5 - Topsoil purpose
                { image: "images/quiz images/IMG_9979.jpeg", question: "What is topsoil for?", options: ["Helping plants spread roots and take in nutrients", "Only for decoration", "Keeping insects away", "Making soil lighter"], correct: 0, explanation: "Topsoil is like a cozy bed for plants, helping them spread their roots and take in nutrients!" },
                // Q6 - Leaf propagation mixing ratio
                { image: "images/quiz images/IMG_9980.jpeg", question: "What is the mixing ratio for leaf propagation?", options: ["3 parts sand : 1 part cocopeat", "1 part sand : 3 parts cocopeat", "2 parts sand : 2 parts cocopeat", "1 part sand : 1 part cocopeat"], correct: 0, explanation: "The mixing ratio for leaf propagation is 3 parts sand to 1 part cocopeat (3:1)!" },
                // Q7 - Handling propagation media
                { image: "images/quiz images/IMG_9981.jpeg", question: "How should you store propagation media to keep it clean?", options: ["In sealed bags", "In open containers", "On the ground uncovered", "In plastic bottles"], correct: 0, explanation: "Put propagation media in sealed bags to keep it clean!" },
                { image: "images/quiz images/IMG_9981.jpeg", question: "What should you do with torn bags of propagation media?", options: ["Cover and lift them onto pallets", "Throw them away", "Leave them on the ground", "Mix them with water"], correct: 0, explanation: "Cover and lift any torn bags onto pallets to keep things clean!" },
                // Q8 - Handling plant media
                { image: "images/quiz images/IMG_9982.jpeg", question: "Should you reuse old plant media mixes?", options: ["No, don't use old mixes again", "Yes, always reuse them", "Only if they look clean", "Only in winter"], correct: 0, explanation: "Don't use old mixes again ‚Äî always use fresh plant media!" },
                { image: "images/quiz images/IMG_9982.jpeg", question: "What should you always do with containers and tools?", options: ["Clean them well", "Leave them dirty", "Throw them away after use", "Share them with others"], correct: 0, explanation: "Always clean containers and tools well before using them!" }
            ],
            plantcare: [
                // Q9 - Why care for young plants
                { image: "images/quiz images/IMG_9983.jpeg", question: "Why do we take care of newly grown plants?", options: ["Young plants are delicate but grow strong with good care", "They don't need care at all", "Only old plants need care", "To make them produce fruit immediately"], correct: 0, explanation: "Young plants are delicate (sensitive), but when we take good care of them, they grow and become strong!" },
                { image: "images/quiz images/IMG_9983.jpeg", question: "What word best describes young plants?", options: ["Delicate", "Strong", "Tough", "Hardy"], correct: 0, explanation: "Young plants are delicate (sensitive) and need special care to grow strong!" },
                // Q10 - Feeding with fertilizer
                { image: "images/quiz images/IMG_9984.jpeg", question: "How much fertilizer should you use on young plants?", options: ["A small amount", "A large amount", "No fertilizer at all", "As much as possible"], correct: 0, explanation: "Use a small amount of fertilizer on young plants!" },
                { image: "images/quiz images/IMG_9984.jpeg", question: "Where should you keep fertilizer when feeding plants?", options: ["Away from the plant's stem", "Directly on the stem", "On the leaves", "Under the roots"], correct: 0, explanation: "Keep fertilizer away from the plant's stem to avoid damage!" },
                { image: "images/quiz images/IMG_9984.jpeg", question: "What are two ways to feed plants with nutrients?", options: ["Small amount of fertilizer, kept away from stem", "Lots of fertilizer on the stem", "Water only, no fertilizer", "Fertilizer on leaves only"], correct: 0, explanation: "Use a small amount of fertilizer on young plants, and keep it away from the plant's stem!" }
            ],
            safety: [
                // Q11 - Inorganic waste disposal
                { image: "images/quiz images/IMG_9985.jpeg", question: "What is Step 1 for throwing away inorganic waste?", options: ["Put the debris in a trash bag", "Tie the bag tightly", "Take it to the disposal area", "Sort the waste by color"], correct: 0, explanation: "Step 1: Put the debris in a trash bag!" },
                { image: "images/quiz images/IMG_9985.jpeg", question: "What is Step 2 for throwing away inorganic waste?", options: ["Tie the trash bag tightly", "Put debris in a bag", "Take it to the disposal area", "Wash the waste first"], correct: 0, explanation: "Step 2: Tie the trash bag tightly!" },
                { image: "images/quiz images/IMG_9985.jpeg", question: "What is Step 3 for throwing away inorganic waste?", options: ["Put the trash bag in the assigned waste disposal area", "Tie the bag", "Put debris in a bag", "Burn the waste"], correct: 0, explanation: "Step 3: Put the trash bag in the assigned waste disposal area!" },
                { image: "images/quiz images/IMG_9985.jpeg", question: "What are the 3 steps for inorganic waste disposal?", options: ["Bag it, tie it, take to assigned area", "Burn it, bury it, forget it", "Wash it, dry it, recycle it", "Sort it, crush it, dump it"], correct: 0, explanation: "The 3 steps are: (1) Put debris in a trash bag, (2) Tie it tightly, (3) Put it in the assigned waste disposal area!" },
                // Q12 - PPE
                { image: "images/quiz images/IMG_9986.jpeg", question: "Name a type of PPE used during propagation activities.", options: ["Gloves", "Apron", "Steel-toe boots", "Earmuffs"], correct: 0, explanation: "Gloves reduce injury risk and prevent contact with harmful chemicals!" },
                { image: "images/quiz images/IMG_9986.jpeg", question: "What do safety goggles protect against during propagation?", options: ["Accidental chemical splashes that could cause blindness", "Dust from soil only", "Rain water", "Bright sunlight"], correct: 0, explanation: "Safety goggles protect eyes from accidental chemical splashes, preventing blindness!" },
                { image: "images/quiz images/IMG_9986.jpeg", question: "Why should you wear a hat during propagation?", options: ["To protect the head from chemicals", "For fashion", "To keep warm", "To carry tools"], correct: 0, explanation: "A hat protects the head from chemicals during propagation activities!" },
                { image: "images/quiz images/IMG_9986.jpeg", question: "Which of these is PPE for propagation?", options: ["All of these: Gloves, Safety goggles, Hat", "Only gloves", "Only goggles", "Only a hat"], correct: 0, explanation: "Gloves, Safety goggles, and a Hat are all PPE used during propagation activities!" },
                // Q13 - Chemical storage
                { image: "images/quiz images/IMG_9987.jpeg", question: "What should you check before storing chemicals?", options: ["The Safety Data Sheet", "The expiry date only", "The color of the chemical", "The weight of the container"], correct: 0, explanation: "Check the Safety Data Sheet for storage requirements!" },
                { image: "images/quiz images/IMG_9987.jpeg", question: "Where should you keep chemicals?", options: ["In their original container", "In any empty bottle", "In plastic bags", "In open bowls"], correct: 0, explanation: "Keep the chemical in its original container!" },
                { image: "images/quiz images/IMG_9987.jpeg", question: "How should chemical containers be labeled?", options: ["With hazard warning signs", "With the date only", "With your name", "No label needed"], correct: 0, explanation: "Properly label the chemical container with hazard warning signs!" },
                { image: "images/quiz images/IMG_9987.jpeg", question: "What are 3 safe ways to store chemicals?", options: ["Check Safety Data Sheet, keep in original container, label with hazard signs", "Hide them, lock them, forget them", "Put in any bottle, store anywhere, no labels needed", "Mix together, store in fridge, label with tape"], correct: 0, explanation: "The 3 safe ways are: (1) Check the Safety Data Sheet, (2) Keep in original container, (3) Label with hazard warning signs!" }
            ]
        };

        function setCategory(category, btnElement) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            btnElement.classList.add('active');

            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('matchArea').style.display = 'none';
            document.getElementById('assessmentArea').style.display = 'none';

            if (category === 'assessment') {
                document.getElementById('assessmentArea').style.display = 'block';
                showAssessmentIntro();
            } else if (category === 'match' || category === 'matchmedia') {
                document.getElementById('matchArea').style.display = 'block';
                activeMatchType = category === 'match' ? 'tools' : 'media';
                startMatch();
            } else {
                document.getElementById('quizArea').style.display = 'block';
                newQuestion();
            }
        }

        function newQuestion() {
            const categoryQuestions = questions[currentCategory];

            // Reset pool if all questions have been asked
            if (!askedQuestions[currentCategory] || askedQuestions[currentCategory].length >= categoryQuestions.length) {
                askedQuestions[currentCategory] = [];
            }

            // Pick a random question that hasn't been asked yet
            const remaining = categoryQuestions
                .map((q, i) => i)
                .filter(i => !askedQuestions[currentCategory].includes(i));
            const pick = remaining[Math.floor(Math.random() * remaining.length)];
            askedQuestions[currentCategory].push(pick);
            currentQuestion = categoryQuestions[pick];
            answered = false;

            const emojiEl = document.getElementById('questionEmoji');
            const imageEl = document.getElementById('questionImage');

            if (currentQuestion.image) {
                emojiEl.style.display = 'none';
                imageEl.src = currentQuestion.image;
                imageEl.style.display = 'block';
            } else {
                emojiEl.style.display = 'block';
                emojiEl.textContent = currentQuestion.emoji;
                imageEl.style.display = 'none';
            }

            document.getElementById('questionText').textContent = currentQuestion.question;
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('explanation').className = 'explanation';
            document.getElementById('nextBtn').style.display = 'none';

            let options = [...currentQuestion.options];
            let correctOption = options[0];
            options = shuffleArray(options);
            let correctIndex = options.indexOf(correctOption);

            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';

            options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => checkAnswer(index, btn, correctIndex, optionsContainer);
                optionsContainer.appendChild(btn);
            });

            playSound('question');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function checkAnswer(selectedIndex, btn, correctIndex, container) {
            if (answered) return;
            answered = true;

            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);

            score.total++;

            if (selectedIndex === correctIndex) {
                score.correct++;
                btn.classList.add('correct');
                document.getElementById('feedback').textContent = 'üéâ Correct!';
                document.getElementById('feedback').className = 'feedback correct';
                playSound('correct');
            } else {
                btn.classList.add('incorrect');
                buttons[correctIndex].classList.add('correct');
                document.getElementById('feedback').textContent = '‚ùå Not quite!';
                document.getElementById('feedback').className = 'feedback incorrect';
                playSound('incorrect');
            }

            document.getElementById('explanation').textContent = currentQuestion.explanation;
            document.getElementById('explanation').className = 'explanation show';

            document.getElementById('scoreNumber').textContent = score.correct;
            document.getElementById('scoreText').textContent = `Correct: ${score.correct} | Total: ${score.total}`;

            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            newQuestion();
        }

        // ========== Match (Tools & Media) ==========

        function getActiveMatchData() {
            return activeMatchType === 'tools' ? toolData : mediaData;
        }

        function startMatch() {
            matchRound = 1;
            matchCorrect = 0;
            matchTotal = 0;
            const nextBtn = document.getElementById('matchNextBtn');
            const restartBtn = document.getElementById('matchRestartBtn');
            nextBtn.style.display = 'none';
            restartBtn.style.display = 'none';
            nextBtn.onclick = () => { matchRound = 2; nextBtn.style.display = 'none'; buildMatchRound(); };
            restartBtn.onclick = () => startMatch();
            buildMatchRound();
        }

        function buildMatchRound() {
            matchSelectedLeft = null;
            matchSelectedRight = null;
            matchMatched = 0;

            const data = getActiveMatchData();
            const container = document.getElementById('matchContainer');
            container.innerHTML = '';

            const label = activeMatchType === 'tools' ? 'tool' : 'media';
            const isRound1 = matchRound === 1;
            document.getElementById('matchRoundInfo').textContent = isRound1
                ? `Round 1: Match each ${label} to its name`
                : `Round 2: Match each ${label} to its function`;

            document.getElementById('matchScore').textContent = '';
            document.getElementById('matchNextBtn').style.display = 'none';
            document.getElementById('matchRestartBtn').style.display = 'none';

            const leftCol = document.createElement('div');
            leftCol.className = 'match-column';
            leftCol.innerHTML = `<h3>${activeMatchType === 'tools' ? 'Tools' : 'Media'}</h3>`;

            const rightCol = document.createElement('div');
            rightCol.className = 'match-column';
            rightCol.innerHTML = isRound1 ? '<h3>Names</h3>' : '<h3>Functions</h3>';

            const leftOrder = shuffleArray([...Array(data.length).keys()]);
            const rightOrder = shuffleArray([...Array(data.length).keys()]);

            matchPairs = data.map((t, i) => ({ index: i, matched: false }));

            leftOrder.forEach(i => {
                const item = document.createElement('div');
                item.className = 'match-item';
                item.dataset.index = i;
                item.dataset.side = 'left';
                item.innerHTML = `<img src="${data[i].image}" alt="${label}"><br><small>?</small>`;
                item.onclick = () => selectMatchItem(item);
                leftCol.appendChild(item);
            });

            rightOrder.forEach(i => {
                const item = document.createElement('div');
                item.className = 'match-item';
                item.dataset.index = i;
                item.dataset.side = 'right';
                item.textContent = isRound1 ? data[i].name : data[i].func;
                item.onclick = () => selectMatchItem(item);
                rightCol.appendChild(item);
            });

            container.appendChild(leftCol);
            container.appendChild(rightCol);
        }

        function selectMatchItem(item) {
            if (item.classList.contains('matched')) return;

            const side = item.dataset.side;
            const data = getActiveMatchData();

            if (side === 'left') {
                if (matchSelectedLeft) matchSelectedLeft.classList.remove('selected');
                matchSelectedLeft = item;
                item.classList.add('selected');
            } else {
                if (matchSelectedRight) matchSelectedRight.classList.remove('selected');
                matchSelectedRight = item;
                item.classList.add('selected');
            }

            if (matchSelectedLeft && matchSelectedRight) {
                const leftIndex = parseInt(matchSelectedLeft.dataset.index);
                const rightIndex = parseInt(matchSelectedRight.dataset.index);
                matchTotal++;

                if (leftIndex === rightIndex) {
                    matchCorrect++;
                    matchSelectedLeft.classList.remove('selected');
                    matchSelectedRight.classList.remove('selected');
                    matchSelectedLeft.classList.add('matched');
                    matchSelectedRight.classList.add('matched');
                    const label = matchSelectedLeft.querySelector('small');
                    if (label) label.textContent = data[leftIndex].name;
                    matchMatched++;
                    playSound('correct');

                    matchSelectedLeft = null;
                    matchSelectedRight = null;

                    if (matchMatched === data.length) {
                        document.getElementById('matchScore').textContent =
                            `Round ${matchRound} complete! ${matchCorrect}/${matchTotal} correct`;
                        if (matchRound === 1) {
                            document.getElementById('matchNextBtn').style.display = 'block';
                        } else {
                            document.getElementById('matchScore').textContent +=
                                ' ‚Äî All done! Great work!';
                            document.getElementById('matchRestartBtn').style.display = 'block';
                        }
                    }
                } else {
                    playSound('incorrect');
                    matchSelectedLeft.classList.add('wrong');
                    matchSelectedRight.classList.add('wrong');
                    const left = matchSelectedLeft;
                    const right = matchSelectedRight;
                    setTimeout(() => {
                        left.classList.remove('selected', 'wrong');
                        right.classList.remove('selected', 'wrong');
                    }, 500);
                    matchSelectedLeft = null;
                    matchSelectedRight = null;
                }
            }
        }

        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                if (type === 'correct') {
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } else if (type === 'incorrect') {
                    oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                } else {
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                }
            } catch (e) {}
        }

        // ========== Assessment ==========

        const assessmentQuestions = [
            // Tools - identify by image (auto-graded)
            { id: 1, image: "images/tools images/IMG_9968.jpeg", question: "What is this tool called?", type: "auto", answer: "Hand Trowel", acceptAlso: ["hand trowel", "trowel"], category: "Tools" },
            { id: 2, image: "images/tools images/IMG_9969.jpeg", question: "What is this tool called?", type: "auto", answer: "Secateurs", acceptAlso: ["secateurs", "secateur", "pruning shears", "pruner", "pruners", "shears"], category: "Tools" },
            { id: 3, image: "images/tools images/IMG_9970.jpeg", question: "What is this tool called?", type: "auto", answer: "Hand Fork", acceptAlso: ["hand fork", "fork", "garden fork"], category: "Tools" },
            { id: 4, image: "images/tools images/IMG_9971.jpeg", question: "What is this tool called?", type: "auto", answer: "Pungkis", acceptAlso: ["pungkis", "basket", "scoop"], category: "Tools" },
            { id: 5, image: "images/tools images/IMG_9972.jpeg", question: "What is this tool called?", type: "auto", answer: "Rake", acceptAlso: ["rake", "garden rake"], category: "Tools" },
            { id: 6, image: "images/tools images/IMG_9973.jpeg", question: "What is this tool called?", type: "auto", answer: "Watering Can", acceptAlso: ["watering can", "water can", "watering"], category: "Tools" },
            { id: 7, image: "images/tools images/IMG_9974.jpeg", question: "What is this tool called?", type: "auto", answer: "Wheelbarrow", acceptAlso: ["wheelbarrow", "wheel barrow", "barrow"], category: "Tools" },

            // Tool functions (auto-graded with keywords)
            { id: 8, question: "What is the function of the Hand Trowel?", type: "auto", answer: "Dig, scoop, and smooth soil media", acceptAlso: ["dig", "scoop", "smooth soil", "digging", "scooping"], category: "Tools" },
            { id: 9, question: "What is the function of the Secateurs?", type: "auto", answer: "Cut stems, leaves, and roots", acceptAlso: ["cut", "cutting", "prune", "pruning", "trim", "trimming"], category: "Tools" },
            { id: 10, question: "What is the function of the Hand Fork?", type: "auto", answer: "Loosen soil and remove weeds", acceptAlso: ["loosen", "loosen soil", "remove weeds", "weeding", "weed"], category: "Tools" },
            { id: 11, question: "What is the function of the Rake?", type: "auto", answer: "Sweep dried leaves and dirt", acceptAlso: ["sweep", "sweeping", "sweep leaves", "leaves", "dried leaves"], category: "Tools" },
            { id: 12, question: "What is the function of the Watering Can?", type: "auto", answer: "Water plants", acceptAlso: ["water", "watering", "water plants", "watering plants"], category: "Tools" },

            // Tool Parts (auto-graded)
            { id: 13, image: "images/tools images/IMG_9958.jpeg", question: "What is Part A on the secateurs called?", type: "auto", answer: "Blades", acceptAlso: ["blades", "blade", "cutting blade", "cutting blades"], category: "Tool Parts" },
            { id: 14, image: "images/tools images/IMG_9958.jpeg", question: "What is Part B on the secateurs called?", type: "auto", answer: "Safety Lock Catch", acceptAlso: ["safety lock", "lock catch", "safety catch", "lock", "catch", "safety lock catch"], category: "Tool Parts" },
            { id: 15, image: "images/tools images/IMG_9958.jpeg", question: "What is Part C on the secateurs called?", type: "auto", answer: "Handle", acceptAlso: ["handle", "handles", "grip"], category: "Tool Parts" },

            // Soil Media - identify by image (auto-graded)
            { id: 16, image: "images/media images/IMG_9959.jpeg", question: "What is this soil media called?", type: "auto", answer: "Sand", acceptAlso: ["sand"], category: "Soil Media" },
            { id: 17, image: "images/media images/IMG_9960.jpeg", question: "What is this soil media called?", type: "auto", answer: "Top Soil", acceptAlso: ["top soil", "topsoil", "soil"], category: "Soil Media" },
            { id: 18, image: "images/media images/IMG_9961.jpeg", question: "What is this soil media called?", type: "auto", answer: "Cocopeat", acceptAlso: ["cocopeat", "coco peat", "coconut peat", "coco"], category: "Soil Media" },
            { id: 19, image: "images/media images/IMG_9962.jpeg", question: "What is this soil media called?", type: "auto", answer: "Perlite", acceptAlso: ["perlite"], category: "Soil Media" },
            { id: 20, image: "images/media images/IMG_9963.jpeg", question: "What is this soil media called?", type: "auto", answer: "Vermiculite", acceptAlso: ["vermiculite"], category: "Soil Media" },

            // Media functions (auto-graded)
            { id: 21, question: "What does Sand do in a soil mix?", type: "auto", answer: "Improves drainage", acceptAlso: ["drainage", "drain", "improves drainage", "draining"], category: "Soil Media" },
            { id: 22, question: "What does Cocopeat do in a soil mix?", type: "auto", answer: "Holds water", acceptAlso: ["holds water", "hold water", "water retention", "retain water", "retains water", "moisture"], category: "Soil Media" },
            { id: 23, question: "What does Perlite do in a soil mix?", type: "auto", answer: "Aeration and drainage", acceptAlso: ["aeration", "drainage", "air", "aerate", "drain"], category: "Soil Media" },

            // Propagation (self-assessed)
            { id: 24, question: "Name two methods of asexual propagation.", type: "self", modelAnswer: "Any two of: Cutting, Grafting, Division, Layering", category: "Propagation" },
            { id: 25, question: "What is the parent plant used for?", type: "self", modelAnswer: "Making new plants through cuttings, division, layering, or grafting. New plants share the same genes as the parent, so they are high quality.", category: "Propagation" },
            { id: 26, question: "What are the two types of graft?", type: "self", modelAnswer: "Scion graft (putting a small plant piece onto stock) and Bud graft (moving a leaf bud from one tree to another)", category: "Propagation" },
            { id: 27, question: "How do you treat buds for pests and diseases?", type: "self", modelAnswer: "Dip the buds in a fungicide solution and keep them in a cool, moist place.", category: "Propagation" },

            // Soil Mix knowledge (self-assessed)
            { id: 28, question: "What is the mixing ratio for leaf propagation?", type: "auto", answer: "3 parts sand to 1 part cocopeat", acceptAlso: ["3:1", "3 to 1", "3 sand 1 cocopeat", "3 parts sand", "three to one"], category: "Soil Media" },
            { id: 29, question: "How should you store propagation media to keep it clean?", type: "self", modelAnswer: "Put propagation media in sealed bags. Cover and lift any torn bags onto pallets.", category: "Soil Media" },

            // Plant Care (self-assessed)
            { id: 30, question: "Why do we take care of newly grown plants?", type: "self", modelAnswer: "Young plants are delicate (sensitive), but when we take good care of them, they grow and become strong.", category: "Plant Care" },
            { id: 31, question: "How should you use fertilizer on young plants?", type: "self", modelAnswer: "Use a small amount of fertilizer and keep it away from the plant's stem.", category: "Plant Care" },

            // Safety (self-assessed)
            { id: 32, question: "What are the 3 steps for throwing away inorganic waste?", type: "self", modelAnswer: "1) Put the debris in a trash bag, 2) Tie the trash bag tightly, 3) Put the trash bag in the assigned waste disposal area.", category: "Safety" },
            { id: 33, question: "Name two pieces of PPE you should wear during propagation.", type: "self", modelAnswer: "Any two of: Gloves (reduce injury, prevent chemical contact), Safety goggles (protect eyes from chemical splashes), Hat (protects head from chemicals)", category: "Safety" },
            { id: 34, question: "How should chemicals be stored safely?", type: "self", modelAnswer: "1) Check the Safety Data Sheet, 2) Keep chemical in its original container, 3) Label the container with hazard warning signs.", category: "Safety" },
            { id: 35, question: "What do safety goggles protect against?", type: "auto", answer: "Chemical splashes that could cause blindness", acceptAlso: ["chemical splashes", "splashes", "chemicals", "blindness", "chemical splash", "eye protection", "protect eyes"], category: "Safety" }
        ];

        let assessmentState = {
            questions: [],
            currentIndex: 0,
            score: 0,
            answers: [], // { question, userAnswer, correct, correctAnswer }
            active: false
        };

        function showAssessmentIntro() {
            const area = document.getElementById('assessmentArea');
            area.innerHTML = `
                <div class="assessment-intro">
                    <h2>üìù Assessment Mode</h2>
                    <p>Answer <strong>20 questions</strong> from memory.<br>
                    Type your answers ‚Äî no multiple choice!<br>
                    You need <strong>70% to pass</strong> (14 out of 20).</p>
                    <p style="font-size: 0.95rem; color: #718096;">Some questions are auto-marked. For longer answers, you'll compare with a model answer and mark yourself.</p>
                    <button class="assessment-start-btn" onclick="startAssessment()">Start Assessment</button>
                </div>
            `;
        }

        function startAssessment() {
            // Pick 20 random non-duplicate questions
            const shuffled = shuffleArray([...assessmentQuestions]);
            assessmentState = {
                questions: shuffled.slice(0, 20),
                currentIndex: 0,
                score: 0,
                answers: [],
                active: true
            };
            showAssessmentQuestion();
        }

        function showAssessmentQuestion() {
            const area = document.getElementById('assessmentArea');
            const q = assessmentState.questions[assessmentState.currentIndex];
            const num = assessmentState.currentIndex + 1;
            const total = assessmentState.questions.length;
            const progressPct = ((num - 1) / total * 100).toFixed(0);

            let imageHtml = '';
            if (q.image) {
                imageHtml = `<img class="question-image" src="${q.image}" alt="Question image" style="display:block; margin: 0 auto 15px;">`;
            }

            area.innerHTML = `
                <div class="assessment-progress">
                    <div class="assessment-progress-text">Question ${num} of ${total}</div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: ${progressPct}%"></div>
                    </div>
                </div>
                <div class="question-card">
                    <span class="assessment-category-tag">${q.category}</span>
                    ${imageHtml}
                    <div class="question-text">${q.question}</div>
                </div>
                <input type="text" class="assessment-input" id="assessmentInput" placeholder="Type your answer here..." autocomplete="off">
                <button class="assessment-submit-btn" id="assessmentSubmitBtn" onclick="submitAssessmentAnswer()">Submit Answer</button>
                <div id="assessmentFeedback"></div>
            `;

            const input = document.getElementById('assessmentInput');
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    submitAssessmentAnswer();
                }
            });
            input.focus();
        }

        function checkFlexibleMatch(userAnswer, correctAnswer, acceptAlso) {
            if (!userAnswer || userAnswer.trim() === '') return false;

            const clean = str => str.toLowerCase().trim().replace(/[^a-z0-9\s:]/g, '').replace(/\s+/g, ' ');
            const userClean = clean(userAnswer);

            if (userClean === '') return false;

            // Check exact match with correct answer
            if (userClean === clean(correctAnswer)) return true;

            // Check against acceptAlso list
            if (acceptAlso) {
                for (const alt of acceptAlso) {
                    const altClean = clean(alt);
                    // User's answer matches an accepted alternative
                    if (userClean === altClean) return true;
                    // User's answer contains the alternative
                    if (userClean.includes(altClean)) return true;
                    // Alternative contains the user's answer (for partial matches like "trowel" matching "hand trowel")
                    if (altClean.includes(userClean) && userClean.length >= 3) return true;
                }
            }

            // Check if user answer contains key words from the correct answer
            const correctWords = clean(correctAnswer).split(' ').filter(w => w.length > 3);
            if (correctWords.length > 0) {
                const matchCount = correctWords.filter(w => userClean.includes(w)).length;
                if (matchCount >= Math.ceil(correctWords.length * 0.5)) return true;
            }

            return false;
        }

        function submitAssessmentAnswer() {
            const input = document.getElementById('assessmentInput');
            const submitBtn = document.getElementById('assessmentSubmitBtn');
            const feedbackDiv = document.getElementById('assessmentFeedback');
            const userAnswer = input.value.trim();
            const q = assessmentState.questions[assessmentState.currentIndex];

            if (!userAnswer) {
                input.style.borderColor = '#f56565';
                input.placeholder = 'Please type an answer first!';
                return;
            }

            submitBtn.disabled = true;
            input.disabled = true;

            if (q.type === 'auto') {
                const isCorrect = checkFlexibleMatch(userAnswer, q.answer, q.acceptAlso);

                if (isCorrect) {
                    assessmentState.score++;
                    input.classList.add('correct-border');
                    feedbackDiv.innerHTML = `
                        <div class="assessment-feedback correct">Correct!</div>
                        <button class="assessment-next-btn" onclick="nextAssessmentQuestion()">Next Question</button>
                    `;
                    playSound('correct');
                } else {
                    input.classList.add('incorrect-border');
                    feedbackDiv.innerHTML = `
                        <div class="assessment-feedback incorrect">Not quite</div>
                        <div class="model-answer"><strong>Correct answer:</strong> ${q.answer}</div>
                        <button class="assessment-next-btn" onclick="nextAssessmentQuestion()">Next Question</button>
                    `;
                    playSound('incorrect');
                }

                assessmentState.answers.push({
                    question: q.question,
                    userAnswer: userAnswer,
                    correct: isCorrect,
                    correctAnswer: q.answer,
                    category: q.category
                });

            } else {
                // Self-assessed: reveal model answer
                feedbackDiv.innerHTML = `
                    <div class="model-answer">
                        <strong>Your answer:</strong> ${userAnswer}<br><br>
                        <strong>Model answer:</strong> ${q.modelAnswer}
                    </div>
                    <p style="text-align: center; color: #4a5568; margin: 10px 0;">Did your answer cover the key points?</p>
                    <div class="self-assess-buttons">
                        <button class="self-assess-btn got-it" onclick="selfAssess(true)">I Got It</button>
                        <button class="self-assess-btn not-quite" onclick="selfAssess(false)">Not Quite</button>
                    </div>
                `;
            }
        }

        function selfAssess(gotIt) {
            const q = assessmentState.questions[assessmentState.currentIndex];
            const input = document.getElementById('assessmentInput');
            const feedbackDiv = document.getElementById('assessmentFeedback');

            if (gotIt) {
                assessmentState.score++;
                input.classList.add('correct-border');
                playSound('correct');
            } else {
                input.classList.add('incorrect-border');
                playSound('incorrect');
            }

            assessmentState.answers.push({
                question: q.question,
                userAnswer: input.value.trim(),
                correct: gotIt,
                correctAnswer: q.modelAnswer,
                category: q.category
            });

            // Replace self-assess buttons with next button
            const buttons = feedbackDiv.querySelector('.self-assess-buttons');
            const hint = feedbackDiv.querySelector('p');
            if (buttons) buttons.remove();
            if (hint) hint.remove();

            const feedback = document.createElement('div');
            feedback.className = `assessment-feedback ${gotIt ? 'correct' : 'incorrect'}`;
            feedback.textContent = gotIt ? 'Marked as correct!' : 'Marked as incorrect';
            feedbackDiv.insertBefore(feedback, feedbackDiv.firstChild);

            const nextBtn = document.createElement('button');
            nextBtn.className = 'assessment-next-btn';
            nextBtn.textContent = 'Next Question';
            nextBtn.onclick = nextAssessmentQuestion;
            feedbackDiv.appendChild(nextBtn);
        }

        function nextAssessmentQuestion() {
            assessmentState.currentIndex++;
            if (assessmentState.currentIndex >= assessmentState.questions.length) {
                showAssessmentResults();
            } else {
                showAssessmentQuestion();
            }
        }

        function showAssessmentResults() {
            const area = document.getElementById('assessmentArea');
            const s = assessmentState;
            const pct = Math.round((s.score / s.questions.length) * 100);
            const passed = pct >= 70;

            const wrongAnswers = s.answers.filter(a => !a.correct);

            let reviewHtml = '';
            if (wrongAnswers.length > 0) {
                reviewHtml = `
                    <div class="review-list">
                        <h3>Review ‚Äî Questions to Practice</h3>
                        ${wrongAnswers.map(a => `
                            <div class="review-item">
                                <div class="review-q">${a.question}</div>
                                <div class="review-your">Your answer: ${a.userAnswer}</div>
                                <div class="review-correct">Correct: ${a.correctAnswer}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            area.innerHTML = `
                <div class="results-summary">
                    <h2>${passed ? 'Well Done!' : 'Keep Practising!'}</h2>
                    <div class="results-score ${passed ? 'pass' : 'fail'}">${s.score}/${s.questions.length}</div>
                    <div class="results-percentage">${pct}%</div>
                    <div class="results-message">
                        ${passed
                            ? 'You passed the assessment! Great recall ‚Äî you are well prepared for your oral test.'
                            : 'You need 70% to pass. Don\'t worry ‚Äî practise the topics below and try again. You\'re getting there!'}
                    </div>
                    <div class="progress-bar" style="margin: 15px 0;">
                        <div class="progress-bar-fill" style="width: ${pct}%; background: ${passed ? 'linear-gradient(90deg, #48bb78, #38a169)' : 'linear-gradient(90deg, #f56565, #e53e3e)'}"></div>
                    </div>
                    ${reviewHtml}
                    <button class="assessment-start-btn" onclick="startAssessment()" style="margin-top: 15px;">Try Again</button>
                </div>
            `;

            if (passed) {
                playSound('correct');
            }
        }

        function retakeAssessment() {
            startAssessment();
        }

        newQuestion();
    </script>
</body>
</html>
